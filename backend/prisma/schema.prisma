// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// --- 1. SCHOOL & COURSE ---

model School {
  id      Int      @id @default(autoincrement())
  name    String   @unique
  courses Course[]
}

model Course {
  id          Int       @id @default(autoincrement())
  code        String    // e.g. "CSE 101"
  name        String    // e.g. "Algorithms"
  credits     Int
  department  String
  
  // Note: This field gets overwritten if multiple profs teach the same course.
  // The real instructor info lives in 'Section'.
  instructor  String    

  schoolId    Int
  school      School    @relation(fields: [schoolId], references: [id])

  sections    Section[]

  @@unique([schoolId, code])
}

// --- 2. SECTION & PROFESSOR (The New Part) ---

model Section {
  id            Int      @id @default(autoincrement())
  sectionCode   String   @unique // e.g. "CSE 101-01"
  
  courseId      Int
  course        Course   @relation(fields: [courseId], references: [id])

  sectionNumber String   
  sectionType   String   // "LEC", "LAB", etc.
  
  // Parent/Child linking (e.g. Labs linked to a Lecture)
  parentId      Int?     
  parent        Section?  @relation("LinkedSections", fields: [parentId], references: [id])
  subSections   Section[] @relation("LinkedSections")

  status        String   
  days          String   
  time          String
  startTime     String
  endTime       String
  location      String
  enrolled      Int
  capacity      Int

  // --- NEW: LINKING TO PROFESSOR ---
  instructor    String   // The raw name from the scraper (e.g. "Tantalo, P.")
  
  // This relation connects the raw string above to the Professor table below.
  professor     Professor? @relation(fields: [instructor], references: [name])
}

model Professor {
  id          String   @id @default(uuid())
  name        String   @unique // Matches "Tantalo, P."
  
  // Rate My Professor Data
  rmpId       String?  // The weird ID RMP uses (e.g. "VGVhY2hlci0yMzM=")
  rating      Float?   // 0.0 to 5.0
  difficulty  Float?   // 0.0 to 5.0
  numRatings  Int?     // How many students reviewed them
  
  // Back-relation to see all classes this prof teaches
  sections    Section[]
}

// --- 3. USER DATA ---

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String   
  name      String
  createdAt DateTime @default(now())

  schedules Schedule[]
}

model Schedule {
  id        Int      @id @default(autoincrement())
  name      String   
  courses   Json     // Stores the list of selected class IDs
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
}